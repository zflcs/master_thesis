# 标题：软硬协同的任务调度、通信机制研究

> - “调度” 一词涉及到任务的状态模型，涉及到任务唤醒，也涉及到优先级队列、任务窃取等
> - “通信” 一词涉及到中断，任务之间、任务与 IO 之间的交互等
> - “软硬协同” 加上 “调度” 和 “通信” 这两个词，体现出硬件在这里起 “调度器 + 中断控制器” 的作用

## 引言

1. 研究背景
   1. 调度机制（强调调度算法中的同步互斥开销，用户态调度缺少抢占机制）
   2. 中断机制（强调中断驱动 I/O，上半段和下半段等）
   3. IPC 机制（强调传统的 IPC 机制，以及近年来出现的用户态中断技术，开销，以及与任务唤醒的结合）
2. 选题意义
   1. 解决调度的同步互斥开销
   2. 提高中断响应速度，减少 CPU 开销
   3. 提供用户态的抢占
   4. IPC、系统调用加速，将通知与任务调度、任务唤醒结合
3. 本文结构

## 文献综述

1. 文献综述（画出表格，强调各自的优缺点）
   1. 调度机制
   2. 减少中断上下文切换开销、减少中断延迟的方法
   3. 中断驱动 I/O、事件循环等
   4. 已有 IPC 机制
2. 本章小结

## 软硬协同的任务调度、通信机制设计（方法论上的抽象）

1. 软硬协同的任务状态模型
   1. 描述哪些状态由硬件维护、哪些由软件维护
   2. 描述清楚任务状态之间如何转换
2. 分层复合型任务标识模型
   1. 分析清楚 OS、进程、线程、协程等概念
   2. 用任务解耦进程、线程和协程的关系为执行流与地址空间和堆栈的组合方式；统一任务（执行流）的抽象；
3. 软硬协同实现任务调度与通知机制结合
   1. 硬件完成由于中断导致的任务状态变化，直接唤醒阻塞任务
4. 本章小结

## 软硬协同的任务调度、通信机制实现（实际的做法）

（画出一张控制器、CPU、IO 设备的整体结构图）

（还需要描述使用的 SoC、硬件描述语言）

1. 控制器的实现
   1. 硬件资源分配器
   2. 任务队列的实现（突出同步互斥、任务窃取、优先级队列等）
   3. 外部中断的处理逻辑
   4. 软件中断（任务通信）的处理逻辑
   5. 发中断的逻辑（中断状态、中断屏蔽等描述）
2. RISC-V CPU 的 N 扩展实现（描述相关的寄存器，以及控制器与 CPU 中断寄存器的连接方式）
3. 提供给软件的接口
   1. 描述端口分配，如何支持多个接收方、发送方同时使用
   2. 如何使用硬件的任务队列实现各种调度算法，体现设计的完善
   3. 如何构建通信通道，并提供抢占式调度
4. 本章小结

## 性能评估

1. 测试环境（需要说明 CPU 与内存交互和设备交互都是通过 AXI 总线协议进行，因此两者的访问速度是相当的）
2. 微基准测试
   1. 接口开销
   2. ipc-bench，体现通信机制上的优化（中断延时，中断上下文切换开销，中断的上下半段、各个阶段的划分对比，各自的开销，画出图片，可参考已有论文）
   3. tokio 调度器对比实验，体现调度机制上的优化（硬件支持的任务窃取机制对比软件实现的任务窃取算法、同步互斥的优化）
3. 综合测试
   1. 采用 ldh 的实验结果，在 rel4 上构建的测试（画出三幅图、原始通知机制、以及采用两种不同的中断控制器的实现的结构图，体现出特权级切换次数、中断次数、并发任务数、响应延时、吞吐率等性能指标）
4. 本章小结

## 结论
